<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>wrictools • wrictools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="wrictools">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">wrictools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/wrictools.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/RedCAP.html">RedCAP</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NinaZiegenbein/wrictools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>wrictools</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NinaZiegenbein/wrictools/blob/master/vignettes/wrictools.Rmd" class="external-link"><code>vignettes/wrictools.Rmd</code></a></small>
      <div class="d-none name"><code>wrictools.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/NinaZiegenbein/wrictools" class="external-link">wrictools</a></span><span class="op">)</span></span></code></pre></div>
<p>Welcome!</p>
<p>This document serves as a guided tutorial for our workshop on
<strong>06.03.2025</strong> at Steno Diabetes Center Aarhus. It is
designed to help you get started using the WRIC_preprocessing package,
but you can use it afterwards to follow it on your own.</p>
<p>Before we dive into the code-along session, please ensure you have
the following installed:</p>
<ul>
<li>
<strong>R</strong>: The programming language we’ll be using for data
analysis and visualization.</li>
<li>
<strong>A Programming Environment (RStudio)</strong>: I will
demonstrate using RStudio, but feel free to use a different IDE.</li>
<li>
<strong>Quarto</strong>: To render this tutorial, if you choose to
go through it by yourself.</li>
</ul>
<details><summary><strong>Click here for installation links and instructions</strong>
</summary><ul>
<li><strong><a href="https://cran.r-project.org/mirrors.html" class="external-link">Install
R</a></strong></li>
<li><strong><a href="https://posit.co/download/rstudio-desktop/" class="external-link">Install
RStudio</a></strong></li>
<li><strong><a href="https://quarto.org/docs/get-started/" class="external-link">Install
Quarto</a></strong></li>
</ul></details><div class="section level2">
<h2 id="faq-and-programming-terms">FAQ and “Programming Terms”<a class="anchor" aria-label="anchor" href="#faq-and-programming-terms"></a>
</h2>
<div class="section level4">
<h4 id="what-is-the-difference-between-r-and-rstudio">What is the difference between R and RStudio?<a class="anchor" aria-label="anchor" href="#what-is-the-difference-between-r-and-rstudio"></a>
</h4>
<p><strong>R</strong> is a programming language, while
<strong>RStudio</strong> is a, so called, integrated development
environment (IDE) designed specifically for R, offering a user-friendly
interface for coding, plotting, and managing projects. You can think of
R like a language, like english, where RStudio is Word - a program you
can write english inside. But you could also use other programs for
example libre office or latex.</p>
</div>
<div class="section level4">
<h4 id="qmd-vs-r-vs-rmd">qmd vs R vs Rmd<a class="anchor" aria-label="anchor" href="#qmd-vs-r-vs-rmd"></a>
</h4>
<p>There are different types of files where you can write R code. A file
ending in <strong>.R</strong> is a standard R script for writing and
running R code, while in <strong>.qmd (Quarto Document)</strong> or
<strong>.Rmd (R Markdown)</strong> you can combine code and text for
dynamic reports, or for example this tutorial.</p>
</div>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>All functions are contained in the <code>R/preprocessing.R</code>
file. But to also have access to example data, doc_strings, tutorials
and HowTo’s please download the entire repository for this workshop.</p>
<div class="section level3">
<h3 id="download-the-repository-from-github">Download the repository from GitHub<a class="anchor" aria-label="anchor" href="#download-the-repository-from-github"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Clone the Repository using Git (Recommended)</li>
</ol>
<p>Using Git is the standard and most efficient way to work with this
repository, as it allows you to easily pull updates and manage changes
in the future. If you don’t have Git installed, you can download it from
here.</p>
<p>To clone the repository:</p>
<ul>
<li>Install Git: If you haven’t already, install Git on your
computer.</li>
<li>Clone the Repository: Open your terminal (or Git Bash on Windows),
and run the following command to clone the repository to your local
machine:</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/hulmanlab/wrictools.git</span></code></pre></div>
<p>This will create a copy of the repository on your local machine, and
you can start working with it immediately.</p>
<ol start="2" style="list-style-type: decimal">
<li>Download the Repository as a ZIP (Alternative)</li>
</ol>
<p>If you prefer not to use Git, you can download the repository as a
ZIP file:</p>
<ul>
<li>Go to the <a href="https://github.com/hulmanlab/wrictools" class="external-link">repository on
GitHub</a>.</li>
<li>Click the Code button, then click Download ZIP.</li>
<li>Extract the ZIP file to your desired location on your machine.</li>
</ul>
<details><summary><strong>Pulling Updates in the Future (Using Git)</strong>
</summary><p>Once you’ve cloned the repository, you can easily stay up to date
with the latest features and changes by pulling new updates from the
repository.</p>
<p>To get the latest changes from the repository navigate to your local
repository. In your terminal, navigate to the directory where you cloned
the repository and then pull Updates to get the latest updates (new
features, bug fixes, etc.):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="bu">cd</span> Documents/wrictools <span class="co">#add your own path here</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">git</span> pull origin main</span></code></pre></div>
This will download and merge any changes from the GitHub repository to
your local copy. By using Git, you can always keep your version
up-to-date with the latest improvements without needing to manually
download or re-extract the repository.
</details>
</div>
<div class="section level3">
<h3 id="set-your-working-directory">Set your working directory<a class="anchor" aria-label="anchor" href="#set-your-working-directory"></a>
</h3>
<ul>
<li>Set your working directory in R to the downloaded WRIC_processing
directory. That means your path should end in
<code>".../WRIC_processing"</code>. You can check the full path, by [add
info for both mac and windows]</li>
<li>
<strong>Via RStudio menu:</strong> Session -&gt; Set Working
Directory -&gt; Choose Directory</li>
<li><strong>Via Terminal:</strong></li>
</ul>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"path/to/this/folder/WRIC_processing"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># To check the current directory</span></span></code></pre>
<details><summary><strong>Why do we change the working directory</strong>
</summary>
The working directory is where RStudio is looking for files. Meaning we
can easily type source(‘R/preprocessing.R’) instead of the entire file
path. There is nothing wrong with specifiying the entire file path and
not changing the working directory. But for this workshop it makes it a
lot easier, when we can all use the same code and this ensure that all
code runs on your computer without having to change anything.
</details><ol start="3" style="list-style-type: decimal">
<li>Importing the functions from the “package”</li>
</ol>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code> runs an R script and loads its functions into
your environment</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"R/preprocessing.R"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="preprocess-wric-data">Preprocess WRIC data<a class="anchor" aria-label="anchor" href="#preprocess-wric-data"></a>
</h2>
<p>Now let’s preprocess the txt files, that is created by the WRIC. The
function <code>preproces_WRIC_file()</code> disentangles the meta-data
at the top of the file (ID, comment etc) and creates DataFrames and
csv-files with the actual data, seperated between both rooms and
summarized between the two measurements for each room.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">preprocess_WRIC_file</span><span class="op">(</span><span class="st">"example_data/data.txt"</span><span class="op">)</span></span>
<span><span class="va">R1_metadata</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">R1_metadata</span></span>
<span><span class="va">R2_metadata</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">R2_metadata</span></span>
<span><span class="va">df_room1</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">df_room1</span></span>
<span><span class="va">df_room2</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">df_room2</span></span></code></pre></div>
<p>The function returns a list with “R1_metadata”, “R2_metadata”,
“df_room1” and “df_room2”. Each item of the list is a DataFrame of
either the metadata or the preprocessed actual data for either room 1 or
2. If ´save_csv` is True, then the DataFrames will be saved as csv files
with “id_comment_WRIC_data.csv” or “id_comment_WRIC_metadata.csv”.</p>
<p>Let’s look at the output really quick for room 1:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">R1_metadata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">df_room1</span><span class="op">)</span></span></code></pre></div>
<p>But the function can do a lot more and has a lot of extra parameters
you can specify. The following is the exact same function call, but
mentioning all optional parameters you can call with their default
values. Default means, that if you do not specify this parameter, this
is the value that the parameter has by default.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">preprocess_WRIC_file</span><span class="op">(</span></span>
<span>    <span class="st">"./example_data/data.txt"</span>, </span>
<span>    code<span class="op">=</span><span class="st">"id"</span>, </span>
<span>    manual<span class="op">=</span><span class="cn">NULL</span>, </span>
<span>    save_csv<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>    path_to_save<span class="op">=</span><span class="cn">NULL</span>, </span>
<span>    combine<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>    method<span class="op">=</span><span class="st">"mean"</span>,</span>
<span>    start<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>    end<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>    notefilepath<span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    keywords_dict<span class="op">=</span><span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here are explanations and options to all parameters you can
specify:</p>
<ul>
<li>
<strong>filepath:</strong> [String, filepath] Directory path to the
WRIC .txt file.</li>
<li>
<strong>code</strong> [String] Method for generating subject IDs.
Default is “id”, also possible to specify “id+comment”, where both ID
and comment values are combined or “manual”, where you can specify your
own.</li>
<li>
<strong>manual</strong> [String] Custom codes for subjects in Room 1
and Room 2 if <code>code</code> is “manual”.</li>
<li>
<strong>save_csv</strong> [Logical], whether to save extracted
metadata and data to CSV files or not. Default is True</li>
<li>
<strong>path_to_save</strong> [String] Directory path for saving CSV
files, NULL uses the current directory, NULL is Deafult.</li>
<li>
<strong>combine</strong> [Logical], whether to combine S1 and S2
measurements. Default is True</li>
<li>
<strong>method</strong> [String] Method for combining measurements
(“mean”, “median”, “s1”, “s2”, “min”, “max”).</li>
<li>
<strong>start</strong> [character or POSIXct or NULL], rows before
this will be removed, if NULL takes first row e.g “2023-11-13
11:43:00”</li>
<li>
<strong>end</strong> [character or POSIXct or NULL], rows after this
will be removed, if NULL takes last rows e.g “2023-11-13 11:43:00”</li>
<li>
<strong>notefilepath:</strong> If you specify a path to the
corresponding notefile, the code will try to automatically extract the
datetime and current protocol specification (sleeping, exercising,
eating etc). If possible please read the [How To Note File]<a href="https://github.com/hulmanlab/wrictools/blob/main/HowToNoteFile.pdf" class="external-link uri">https://github.com/hulmanlab/wrictools/blob/main/HowToNoteFile.pdf</a>),
before you start your study for consistent note taking. If there is a
TimeStamp in the note e.g “Participants starts eating at 16:10”, the
time of the creation of the note will be overwritten with the time
specified in the free-text of the note. The “protocol” is extracted by
keyword search. You can check currently included keywords and extend
them by checking the keywords_dict in the extract_note_info() function
of the preprocessing.R file.</li>
<li>
<strong>keywords_dict:</strong> [Nested List] A “dictionary” with
keywords for extracting protocol information out of the notefile.</li>
</ul>
<div class="section level3">
<h3 id="your-turn">
<span style="color:green">Your Turn</span><a class="anchor" aria-label="anchor" href="#your-turn"></a>
</h3>
<p>So now it is your turn. Using the <code>preprocess_WRIC_file()</code>
method create a csv file using “data.txt” in folder example_data.</p>
<ol style="list-style-type: decimal">
<li>create a csv with the name “XXXX_WRIC_data.csv” combining S1 and S2
measurements by taking the mean between them.</li>
<li>create a csv, but cut-off the start to 10:45 on 13/11/2023 and the
end to 11:58 on the same day. The csv should be saved as
“testing_start_end_parameter_WRIC_data.csv”.</li>
<li>
<em>Optional:</em> Try out the notefilepath parameter and see what
happens.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="automatic-note-file-extraction---adaptation-to-your-notes">Automatic note file extraction - adaptation to your notes<a class="anchor" aria-label="anchor" href="#automatic-note-file-extraction---adaptation-to-your-notes"></a>
</h2>
<p>One helpful feature of the <code>preprocess_WRIC_file()</code> method
is to automatically extract the protocol from the note_file, that is
filled in manually during the experiment. With “protocol” I mean coding
wether the participant is currently sleeping, eating, exercising etc.
This enables quick processing and easy access to extract and compare
various e.g. eating periods. Let’s try it:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">preprocess_WRIC_file</span><span class="op">(</span><span class="st">"./example_data/data.txt"</span>, </span>
<span>                            notefilepath<span class="op">=</span><span class="st">"./example_data/note.txt"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">df_room1</span><span class="op">)</span></span></code></pre></div>
<p>When looking at <code>df_room1</code> now, we can see a new column
called “protocol”. We can see the file starts with 0 and at 22:41:21
changes to 1.</p>
<div class="section level3">
<h3 id="your-turn-1">
<span style="color:green">Your Turn</span><a class="anchor" aria-label="anchor" href="#your-turn-1"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Look into the <code>note.txt</code> file and find out why there is a
change at 22:41:21 and what 0 and 1 might represent. Are there more
numbers? What do they represent?</li>
<li>When comparing with previous results, notice that the file now
starts at a later time and stops at an earlier one. Why might that be?
_OBS:_Since we keep reusing variable names (result, df_room1 etc) and
use the same data.txt file to create csv_files, we overwrite those files
and variables. That is completely fine for this tutorial, where we are
focused on how to use it and not the results. But be careful in your own
work!</li>
</ol>
</div>
<div class="section level3">
<h3 id="a-bit-more-information-about-extracting-data-from-the-notefile">A bit more information about extracting data from the notefile<a class="anchor" aria-label="anchor" href="#a-bit-more-information-about-extracting-data-from-the-notefile"></a>
</h3>
<p>When specifying a notefilepath, the function will</p>
<ol style="list-style-type: decimal">
<li><p>Check wether there is a time in the first row. If there is, this
will be used to calculate the drift of the system. This drift will be
added to all further datetimes you sepcify within the notefile.</p></li>
<li>
<p>Check wether there is information about the partcipant entering
or exiting the chamber. If yes, the data is cut to only include times in
wich the participant is in the chamber.</p>
<details><summary><p><strong>What are the keywords for entering/exiting?</strong></p>
</summary><p>start = c(“ind i kammer”, “enter”, “ind”, “entry”) This is only
checked in the first three rows. Reasoning behind it, is that the first
shows the time drift and then there might be two rows - one for each
participant - detailing their entry into the chamber.</p>
<p>end = c(“ud”, “exit”, “out”) This is only checked for the two last
rows.</p>
</details>
</li>
<li><p>Read each row and compare if it contains a keyword that responds
to one of the predefined keywords. If yes change the label for that time
and all following times until the next match. If you do not specify the
<code>keywords_dict</code> parameter it will use a default dictionary of
keywords and protocol values:</p></li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">keywords_dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      sleeping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>keywords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"seng"</span>, <span class="st">"sleeping"</span>, <span class="st">"bed"</span>, <span class="st">"sove"</span>, <span class="st">"soeve"</span>, <span class="st">"godnat"</span>, <span class="st">"night"</span>, <span class="st">"sleep"</span><span class="op">)</span><span class="op">)</span>, value <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>      eating <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>keywords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"start"</span>, <span class="st">"begin"</span>, <span class="st">"began"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"maaltid"</span>, <span class="st">"måltid"</span>, <span class="st">"eat"</span>, <span class="st">"meal"</span>, <span class="st">"food"</span>, <span class="st">"spis"</span>, <span class="st">"maal"</span>, <span class="st">"måd"</span>, <span class="st">"mad"</span>, <span class="st">"frokost"</span>, <span class="st">"morgenmad"</span>, <span class="st">"middag"</span>, <span class="st">"snack"</span>, <span class="st">"aftensmad"</span><span class="op">)</span><span class="op">)</span>, value <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, </span>
<span>      stop_sleeping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>keywords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vaagen"</span>, <span class="st">"vågen"</span>, <span class="st">"vaekke"</span>, <span class="st">"væk"</span>, <span class="st">"wake"</span>, <span class="st">"woken"</span>, <span class="st">"vaagnet"</span><span class="op">)</span><span class="op">)</span>, value <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, </span>
<span>      stop_anything <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>keywords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"faerdig"</span>, <span class="st">"færdig"</span>, <span class="st">"stop"</span>, <span class="st">"end "</span>, <span class="st">"finished"</span>, <span class="st">"slut"</span><span class="op">)</span><span class="op">)</span>, value <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, </span>
<span>      activity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>keywords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"start"</span>, <span class="st">"begin"</span>, <span class="st">"began"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"step"</span>, <span class="st">"exercise"</span>, <span class="st">"physical activity"</span>, <span class="st">"active"</span>, <span class="st">"motion"</span>, <span class="st">"aktiv"</span><span class="op">)</span><span class="op">)</span>, value <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>      ree_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>keywords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"start"</span>, <span class="st">"begin"</span>, <span class="st">"began"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"REE"</span>, <span class="st">"BEE"</span>, <span class="st">"BMR"</span>, <span class="st">"RMR"</span>, <span class="st">"RER"</span><span class="op">)</span><span class="op">)</span>, value <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>If there are to lists e.g. for <code>sleeping</code>, at least one
word of each list need to be present for it to be classified as
sleeping. The value at the end of the list is the value used int he
protocol column in the created dataframe.</p>
<ol start="4" style="list-style-type: decimal">
<li>Check wether there is a timestamp within the comment. If yes, the
time drift is added (if available) and the time in the comment is used
instead of the one made in the note file.</li>
</ol>
</div>
<div class="section level3">
<h3 id="your-turn-2">
<span style="color:green">Your Turn</span><a class="anchor" aria-label="anchor" href="#your-turn-2"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Look at the <code>note_new.txt</code> notefile. Then use
notefilepath and specify keywords_dict to automatically process the
notefile. Use <code>data.txt</code> as the data file. Which comment
might be hard to catch with keywords and should be avoided using the
<code>HowToNotefile.pdf</code>?</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="docstrings">Docstrings<a class="anchor" aria-label="anchor" href="#docstrings"></a>
</h2>
<p>Docstrings are text that explain what a function does, what parameter
you can specify and what (if any) function returns. For packages in R
that you have installed you can read the docstring by typing
<code>?functionname</code>. Since this is not an official package (yet)
this unfortunately does not work yet, but I have created a bit of a
workaround. As long as you copy and paste the following piece of code to
the top of your R script, you can use <code>doc("functionname")</code>
to receive the same output - show docstring to see parameter
documentation</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This part tries to import the documentation of the functions</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"R/function_docs.R"</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Documentation file 'function_docs.R' not found. </span></span>
<span><span class="st">      Proceeding without documentation.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This part assigns the documentation imported above to each imported function</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"function_docs"</span>, envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">func_name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">function_docs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="va">func_name</span>, envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">func</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">func_name</span>, envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="va">func_name</span>, <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="va">func</span>, doc <span class="op">=</span> <span class="va">function_docs</span><span class="op">[[</span><span class="va">func_name</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, </span>
<span>            envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let’s try it and look a bit closer at the output:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">doc</span><span class="op">(</span><span class="st">"preprocess_WRIC_file"</span><span class="op">)</span></span></code></pre></div>
<p>The first sentance is a summary of what the function does. Next there
is a list of parameters with the tag <span class="citation">@param</span>, followed by the name, the type of
variable and a short description. Finally there is an <span class="citation">@return</span> statement, stating what the function
returns.</p>
</div>
<div class="section level2">
<h2 id="batch-processing">Batch Processing<a class="anchor" aria-label="anchor" href="#batch-processing"></a>
</h2>
<p>Next lets look at processing multiple files together. You might have
all of your wric_data files in one folder and want to process them at
the same time. This is an example of just that. In the example_data
folder is a folder named my_project with three wric-data files and each
containing two participants. That means at the end we have generated 12
files, 6 data files and 6 metadata files.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify the folder with the wric_data</span></span>
<span><span class="va">data_folder</span> <span class="op">&lt;-</span> <span class="st">"./example_data/my_project"</span></span>
<span></span>
<span><span class="co"># Find all files in the folder that start with "Results_"</span></span>
<span><span class="va">data_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">data_folder</span>, pattern <span class="op">=</span> <span class="st">"^Results_"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Iterate over all files, call the function and save the csv-files in the same folder</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">data_file</span> <span class="kw">in</span> <span class="va">data_files</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">preprocess_WRIC_file</span><span class="op">(</span><span class="va">data_file</span>, path_to_save <span class="op">=</span> <span class="va">data_folder</span>, code <span class="op">=</span> <span class="st">"id+comment"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>When you also want to process note files with it, the code becomes a
little bit more complex, since you want to make sure that the correct
files are processed together. You can do this based on the shared date
in the filename, or a more labour intensive, but maybe easier option is
to create a list of filename pairs. Below you can see both options:</p>
<div class="section level6">
<h6 id="option-1---pairs-based-on-shared-dates">Option 1 - Pairs based on shared dates<a class="anchor" aria-label="anchor" href="#option-1---pairs-based-on-shared-dates"></a>
</h6>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_folder</span> <span class="op">&lt;-</span> <span class="st">"./example_data/my_project"</span></span>
<span></span>
<span><span class="va">data_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">data_folder</span>, pattern <span class="op">=</span> <span class="st">"^Results_.*_(\\d{12})\\.txt$"</span>, </span>
<span>                        full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">note_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">data_folder</span>, pattern <span class="op">=</span> <span class="st">"^note_(\\d{12})\\.txt$"</span>, </span>
<span>                        full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a lookup table by extracting the 12-digit date from the filenames</span></span>
<span><span class="va">note_lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">note_files</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"^(note_)(\\d{12})\\.txt$"</span>, <span class="st">"\\2"</span>, </span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">note_files</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through the data files and match the date with the note_lookup</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">data_file</span> <span class="kw">in</span> <span class="va">data_files</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">".*_(\\d{12})\\.txt$"</span>, <span class="st">"\\1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">data_file</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">date</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">note_lookup</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">preprocess_WRIC_file</span><span class="op">(</span><span class="va">data_file</span>, notefilepath <span class="op">=</span> <span class="va">note_lookup</span><span class="op">[</span><span class="va">date</span><span class="op">]</span>, </span>
<span>                          path_to_save <span class="op">=</span> <span class="va">data_folder</span>, code <span class="op">=</span> <span class="st">"id+comment"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Processed: "</span>, <span class="va">data_file</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level6">
<h6 id="option-2---based-on-file-pairs">Option 2 - Based on File-Pairs<a class="anchor" aria-label="anchor" href="#option-2---based-on-file-pairs"></a>
</h6>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Manually specify the pairs of data files and note files</span></span>
<span><span class="va">filename_pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    data_file <span class="op">=</span> <span class="st">"./example_data/my_project/Results_1m_0101_202501130800.txt"</span>,</span>
<span>    note_file <span class="op">=</span> <span class="st">"./example_data/my_project/note_202501130800.txt"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    data_file <span class="op">=</span> <span class="st">"./example_data/my_project/Results_1m_0101_202501190800.txt"</span>,</span>
<span>    note_file <span class="op">=</span> <span class="st">"./example_data/my_project/note_202501190800.txt"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    data_file <span class="op">=</span> <span class="st">"./example_data/my_project/Results_1m_0101_202501250800.txt"</span>,</span>
<span>    note_file <span class="op">=</span> <span class="st">"./example_data/my_project/note_202501250800.txt"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through the filename pairs and process them</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">pair</span> <span class="kw">in</span> <span class="va">filename_pairs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">preprocess_WRIC_file</span><span class="op">(</span><span class="va">pair</span><span class="op">$</span><span class="va">data_file</span>, notefilepath <span class="op">=</span> <span class="va">pair</span><span class="op">$</span><span class="va">note_file</span>, </span>
<span>                        path_to_save <span class="op">=</span> <span class="st">"./example_data/my_project"</span>, </span>
<span>                        code <span class="op">=</span> <span class="st">"id+comment"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Processed: "</span>, <span class="va">pair</span><span class="op">$</span><span class="va">data_file</span>, <span class="st">" and "</span>, <span class="va">pair</span><span class="op">$</span><span class="va">note_file</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Your folder structure might look different, so you might have to
adjust this code. <em>(ChatGPT can be very helpful, or feel free to ask
me, if your stuck.)</em></p>
</div>
<div class="section level3">
<h3 id="redcap">RedCap<a class="anchor" aria-label="anchor" href="#redcap"></a>
</h3>
<p>You can also use RedCap’s API (Application Programming Interface) to
use files directly from RedCap, and also upload the resulting files. To
loop over record IDs and process all files within a project on RedCap,
use the <code>preprocess_WRIC_files</code> function. To find out more
about using RedCap, refer to this tutorial: <a href="https://github.com/hulmanlab/wrictools/blob/main/tutorials/RedCap_tutorial.qmd" class="external-link">tutorials/RedCap_tutorial.qmd</a></p>
<p><em>OBS:</em> During processing, the data-file(s) will be downloaded
and afterwards deleted again. If the data is not allowed to be on your
personal device at any point, please use this package on a secure
server, where you are allowed to (temporarily) store the data.</p>
<p>Should this be in general the end of this “basic” tutorial and be
split up into multiple tutorials? -&gt; NO I think makes sense to keep
it as this for the workshop</p>
</div>
</div>
<div class="section level2">
<h2 id="working-with-a-subset-of-the-data-specific-time">Working with a subset of the data (specific time)<a class="anchor" aria-label="anchor" href="#working-with-a-subset-of-the-data-specific-time"></a>
</h2>
<p>Often you are interested in a certain time period (e.g. after eating
or during exercise) and want to perform some calculations based on those
time frames. Let’s look at how we would do that.</p>
<ol style="list-style-type: decimal">
<li>Import the preprocessed data (the csv-file) <em>You can skip this
step, if you already have the data.frame, for example right after
calling</em> <code>preprocess_WRIC_files</code>.</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"./example_data/my_project/AB56_Visit 1_WRIC_data.csv"</span><span class="op">)</span> </span>
<span><span class="co"># If you followed the tutorial so far, you should have created this csv file </span></span>
<span><span class="co"># in this location (otherwise go back to Batch Processing and execute the first </span></span>
<span><span class="co"># code chunk or choose a different path</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Let’s extract the data that we are interested in. Let’s start with
the first time our participant is eating (breakfast) including one hour
afterwards.</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we take the first (1) instance where the protocol is 2 (eating)</span></span>
<span><span class="va">breakfast_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">protocol</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">breakfast_index</span><span class="op">)</span></span>
<span><span class="co"># we create a new data.frame where we take the next 60 rows, including the start_index</span></span>
<span><span class="va">data_breakfast</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">breakfast_index</span><span class="op">:</span><span class="op">(</span><span class="va">breakfast_index</span> <span class="op">+</span> <span class="fl">59</span><span class="op">)</span>,<span class="op">]</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">data_breakfast</span><span class="op">)</span> <span class="co">#Let's look at the data to check wether it worked correctly</span></span></code></pre></div>
<p>Maybe we want to compare RER after breakfast with RER after dinner.
So let’s extract the dinner time. As participants are eating for some
time (e.g 15min) there are 15 rows where protocol is 2. So it would not
work to just take the second instance, but we need to identify
transitions from another number to 2 and then choose the second
transition <em>(if this is something that is difficult and happens
often, this could be a feature for the future?)</em></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we additionally check wether the row right before (lag) is not 2 and </span></span>
<span><span class="co"># then take the second instance (2) to get the dinner time</span></span>
<span><span class="va">dinner_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">protocol</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">protocol</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">2</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> </span>
<span><span class="va">data_dinner</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">dinner_index</span><span class="op">:</span><span class="op">(</span><span class="va">dinner_index</span> <span class="op">+</span> <span class="fl">59</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">data_dinner</span><span class="op">)</span> <span class="co">#Let's look at the data to check wether it worked correctly</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Now we can compare the two dataframes. For this example let’s use a
paired t-test to check wether there are differences in RER between
breakfast and dinner. <em>Please note, this is randomly generated
synthetic data and does not represent realistic data. So you can not
pull any insights out of this. It’s purely to demonstrate how you would
use this.</em>
</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">data_breakfast</span><span class="op">$</span><span class="va">RER</span>, <span class="va">data_dinner</span><span class="op">$</span><span class="va">RER</span>, paired <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Perfect, that was easy enough. Some more helpful functions, you might
want to use for/on your sub-dataframes:</p>
<ul>
<li>
<code>add_relative_time(dataframe)</code> - Renumbers
<em>relative_time</em> column starting from 0. Might be more intuitiv
for further use. Example:
<code>data_dinner &lt;- add_relative_time(data_dinner)</code>
</li>
<li>
<code>cut_rows</code>- With this function you can easily create a
subdataframe (like we did above) based on datetime values (instead of
the protocol value). Example:
<code>data_dinner &lt;- cut_rows(data, start="2023-11-14 20:04:00", end="2023-11-14 21:04:00")</code>
</li>
<li>
</li>
</ul>
<p>Of course you can do these analyes batch-wise as well, the same way
as above. Here an example:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">folder_path</span>, pattern <span class="op">=</span> <span class="st">"_data\\.csv$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">file</span> <span class="kw">in</span> <span class="va">files</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span>    <span class="va">breakfast_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">protocol</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">data_breakfast</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">breakfast_index</span><span class="op">:</span><span class="op">(</span><span class="va">breakfast_index</span> <span class="op">+</span> <span class="fl">59</span><span class="op">)</span>,<span class="op">]</span> </span>
<span>    <span class="va">dinner_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">protocol</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">protocol</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">2</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> </span>
<span>    <span class="va">data_dinner</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">dinner_index</span><span class="op">:</span><span class="op">(</span><span class="va">dinner_index</span> <span class="op">+</span> <span class="fl">59</span><span class="op">)</span>,<span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"T-Test Result for : "</span>, <span class="va">file</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">data_breakfast</span><span class="op">$</span><span class="va">RER</span>, <span class="va">data_dinner</span><span class="op">$</span><span class="va">RER</span>, paired <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualizing">Visualizing<a class="anchor" aria-label="anchor" href="#visualizing"></a>
</h2>
<p>Let’s try to visualize the data highlighted by the protocol. First we
need to import the script with visualization functions:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"R/visualizations.R"</span><span class="op">)</span></span></code></pre></div>
<p>Now we can try with one of our generated files:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize_with_protocol.html">visualize_with_protocol</a></span><span class="op">(</span><span class="st">"./example_data/my_project/AB56_Visit 2_WRIC_data.csv"</span><span class="op">)</span> </span></code></pre></div>
<p>We can see that it plotted RER (Respiratory Exchange Ratio) over time
and highlighted the protocol. But what if we wanted to plot energy
expenditure instead? To see all parameters we can specify, let’s use the
doc() function again.</p>
<div class="section level3">
<h3 id="your-turn-3">
<span style="color:green">Your Turn</span><a class="anchor" aria-label="anchor" href="#your-turn-3"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Use the doc() function to find the parameters you can specify</li>
<li>Try adjusting the protocol_colors_label parameters</li>
<li>Iterate over all data-files in the my_project folder.</li>
</ol>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">doc</span><span class="op">(</span><span class="st">"visualize_with_protocol"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Path to the folder containing the files</span></span>
<span><span class="va">folder_path</span> <span class="op">&lt;-</span> <span class="st">"example_data/my_project"</span></span>
<span></span>
<span><span class="co"># Get all files ending with "_data.csv"</span></span>
<span><span class="va">csv_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">folder_path</span>, pattern <span class="op">=</span> <span class="st">"_data.csv"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">dataframes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">protocol_colors_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  protocol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"purple"</span>, <span class="st">"#4b3302"</span>, <span class="st">"#48c5a6"</span>, <span class="st">"#d0a4c6"</span><span class="op">)</span>,</span>
<span>  label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Normal"</span>, <span class="st">"Something"</span>, <span class="st">"Nothing"</span>, <span class="st">"Third Thing"</span>, <span class="st">"?"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">file</span> <span class="kw">in</span> <span class="va">csv_files</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/visualize_with_protocol.html">visualize_with_protocol</a></span><span class="op">(</span><span class="va">file</span>, plot<span class="op">=</span><span class="st">"Energy Expenditure (kcal/min)"</span>, </span>
<span>                          protocol_colors_labels <span class="op">=</span> <span class="va">protocol_colors_labels</span>,</span>
<span>                          save_png <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>That concludes this tutorial. Now you know all basic functionalities
of the package and are ready to use it in your own projects and with
real data. Have fun!</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nina Ziegenbein.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
